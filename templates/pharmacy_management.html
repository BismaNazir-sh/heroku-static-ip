{% extends 'base.html' %}

{% block title %}
  Pharmacy - MDExam
{% endblock %}

{% block content %}
  <div style="display: flex; justify-content: space-between; aling-items: center; margin-bottom: 16px;">
    <h6 class="text-dark text-left pb-2"><span class="text-black">5Axis ></span> Pharmacy Management</h6>
    <button type="button" class="btn btn-primary text-white btn-theme" data-toggle="modal" data-target="#insertModal">Add Pharmacy</button>
  </div>

  <div class="modal fade" id="insertModal" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Add Pharmacy</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        </div>

        <div class="modal-body">
          <form id="add-pharmacy-form" class="mx-4" method="post"  action="/management/create_pharmacy/" autocomplete="off">
            <div class="form-row">
              <div class="col-md-6">
                <div class="form-group">
                  <label>Pharmacy Name</label>
                  <input name="pharmacy_name", id="pharmacy_name" autocomplete="false" type="text" class="form-control" placeholder="Enter pharmacy name" />
                </div>
              </div>

              <div class="col-md-3">
                <div class="form-group">
                  <label>NCPDPID</label>
                  <input name="ncpdpid" id="ncpdpid" required autocomplete="false" type="text" class="form-control" placeholder="Enter ncpdp ID" />
                </div>
              </div>
             </div>

            <div class="row">
              <div class="col-md-6">
                <div class="form-group">
                  <label>Contact Email</label>
                  <input name="pharmacy_email" id="pharmacy_email" required autocomplete="false" type="email" class="form-control" placeholder="Enter email" />
                </div>
              </div>

              <div class="col-md-6">
                <div class="form-group">
                  <label>Phone number</label>
                  <input name="pharmacy_phoneNumber" id="pharmacy_phoneNumber" required autocomplete="false" type="tel" class="form-control" placeholder="Enter phone" />
                </div>
              </div>
            </div>

            <div class="form-row">
              <div class="col-md-6">
                <div class="form-group">
                  <label>Street Address</label>
                  <input name="address_line1" id="address_line1" required autocomplete="false" type="text" class="form-control" placeholder="Enter street address" />
                </div>
              </div>

              <div class="col-md-3">
              
                <label for="state">State</label>
                <select name="state" id="state" class="form-control" required>
                  <option value="">Select state</option>
                  <option value="Alabama">Alabama</option>
                  <option value="Alaska">Alaska</option>
                  <option value="Arizona">Arizona</option>
                  <option value="Arkansas">Arkansas</option>
                  <option value="California">California</option>
                  <option value="Colorado">Colorado</option>
                  <option value="Connecticut">Connecticut</option>
                  <option value="Delaware">Delaware</option>
                  <option value="Florida">Florida</option>
                  <option value="Georgia">Georgia</option>
                  <option value="Hawaii">Hawaii</option>
                  <option value="Idaho">Idaho</option>
                  <option value="Illinois">Illinois</option>
                  <option value="Indiana">Indiana</option>
                  <option value="Iowa">Iowa</option>
                  <option value="Kansas">Kansas</option>
                  <option value="Kentucky">Kentucky</option>
                  <option value="Louisiana">Louisiana</option>
                  <option value="Maine">Maine</option>
                  <option value="Maryland">Maryland</option>
                  <option value="Massachusetts">Massachusetts</option>
                  <option value="Michigan">Michigan</option>
                  <option value="Minnesota">Minnesota</option>
                  <option value="Mississippi">Mississippi</option>
                  <option value="Missouri">Missouri</option>
                  <option value="Montana">Montana</option>
                  <option value="Nebraska">Nebraska</option>
                  <option value="Nevada">Nevada</option>
                  <option value="New Hampshire">New Hampshire</option>
                  <option value="New Jersey">New Jersey</option>
                  <option value="New Mexico">New Mexico</option>
                  <option value="New York">New York</option>
                  <option value="North Carolina">North Carolina</option>
                  <option value="North Dakota">North Dakota</option>
                  <option value="Ohio">Ohio</option>
                  <option value="Oklahoma">Oklahoma</option>
                  <option value="Oregon">Oregon</option>
                  <option value="Pennsylvania">Pennsylvania</option>
                  <option value="Rhode Island">Rhode Island</option>
                  <option value="South Carolina">South Carolina</option>
                  <option value="South Dakota">South Dakota</option>
                  <option value="Tennessee">Tennessee</option>
                  <option value="Texas">Texas</option>
                  <option value="Utah">Utah</option>
                  <option value="Vermont">Vermont</option>
                  <option value="Virginia">Virginia</option>
                  <option value="Washington">Washington</option>
                  <option value="West Virginia">West Virginia</option>
                  <option value="Wisconsin">Wisconsin</option>
                  <option value="Wyoming">Wyoming</option>
                </select>
              </div>

              <div class="col-md-3">
                <div class="form-group">
                
                  <label>State Code</label>
                  <select name="state_code" id="state_code" class="form-control" required>
                    <option value="">Select state code</option>
                    <option value="AL">AL</option>
                    <option value="AK">AK</option>
                    <option value="AZ">AZ</option>
                    <option value="AR">AR</option>
                    <option value="CA">CA</option>
                    <option value="CO">CO</option>
                    <option value="CT">CT</option>
                    <option value="DE">DE</option>
                    <option value="FL">FL</option>
                    <option value="GA">GA</option>
                    <option value="HI">HI</option>
                    <option value="ID">ID</option>
                    <option value="IL">IL</option>
                    <option value="IN">IN</option>
                    <option value="IA">IA</option>
                    <option value="KS">KS</option>
                    <option value="KY">KY</option>
                    <option value="LA">LA</option>
                    <option value="ME">ME</option>
                    <option value="MD">MD</option>
                    <option value="MA">MA</option>
                    <option value="MI">MI</option>
                    <option value="MN">MN</option>
                    <option value="MS">MS</option>
                    <option value="MO">MO</option>
                    <option value="MT">MT</option>
                    <option value="NE">NE</option>
                    <option value="NV">NV</option>
                    <option value="NH">NH</option>
                    <option value="NJ">NJ</option>
                    <option value="NM">NM</option>
                    <option value="NY">NY</option>
                    <option value="NC">NC</option>
                    <option value="ND">ND</option>
                    <option value="OH">OH</option>
                    <option value="OK">OK</option>
                    <option value="OR">OR</option>
                    <option value="PA">PA</option>
                    <option value="RI">RI</option>
                    <option value="SC">SC</option>
                    <option value="SD">SD</option>
                    <option value="TN">TN</option>
                    <option value="TX">TX</option>
                    <option value="UT">UT</option>
                    <option value="VT">VT</option>
                    <option value="VA">VA</option>
                    <option value="WA">WA</option>
                    <option value="WV">WV</option>
                    <option value="WI">WI</option>
                    <option value="WY">WY</option>
                  </select>
                
                </div>
              </div>
            </div>

            <div class="form-row">
              <div class="col-md-6">
                <label>City</label>
                <input type="text" name="city" id="city" class="form-control" placeholder="Enter city" required />
              </div>
              <div class="col-md-3">
                <label>Zip</label>
                <input type="text" name="zip_code" id="zip_code" class="form-control" placeholder="Enter Zip" required />
              </div>
              <div class="col-md-3">
                <label>Country</label>
                <input type="text" name="country" id="country" class="form-control" placeholder="Enter country" value="US" />
              </div>
              
            </div>

            <!-- add a form row same as above with 4 values, weight, dim1, dim2, dim3-->
            <br>
            <div class="form-row">
              <div class="col-md-3">
                <label>Weight</label>
                <input type="text" name="weight" id="weight" class="form-control" placeholder="Enter weight" required />
              </div>
              <div class="col-md-3">
                <label>Dim1</label>
                <input type="text" name="dim1" id="dim1" class="form-control" placeholder="Enter dim1" required />
              </div>
              <div class="col-md-3">
                <label>Dim2</label>
                <input type="text" name="dim2" id="dim2" class="form-control" placeholder="Enter dim2" required />
              </div>
              <div class="col-md-3">
                <label>Dim3</label>
                <input type="text" name="dim3" id="dim3" class="form-control" placeholder="Enter dim3" required />
              </div>
            </div>



            <div class="modal-footer">
              <button form="add-pharmacy-form" type="submit" class="btn btn-primary">Save changes</button>
              <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
          </form>
        </div>

        
      </div>
    </div>
  </div>


  <div class="modal fade" id="updateModal" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Update Pharmacy</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        </div>

        <div class="modal-body">
          <form id="update-pharmacy-form" class="mx-4" method="post"  action="/management/update_pharmacy/" autocomplete="off">
            <div class="form-row">
              <div class="col-md-6">
                <div class="form-group">
                  <label>Pharmacy Name</label>
                  <input name="update_pharmacy_name", id="update_pharmacy_name" autocomplete="false" type="text" class="form-control" placeholder="Enter pharmacy name" />
                </div>
              </div>

              <div class="col-md-3">
                <div class="form-group">
                  <label>NCPDPID</label>
                  <input name="update_ncpdpid" id="update_ncpdpid" required autocomplete="false" type="text" class="form-control" placeholder="Enter ncpdp ID" readonly/>
                </div>
              </div>
             </div>

            <div class="row">
              <div class="col-md-6">
                <div class="form-group">
                  <label>Contact Email</label>
                  <input name="update_pharmacy_email" id="update_pharmacy_email" required autocomplete="false" type="email" class="form-control" placeholder="Enter email" />
                </div>
              </div>

              <div class="col-md-6">
                <div class="form-group">
                  <label>Phone number</label>
                  <input name="update_pharmacy_phoneNumber" id="update_pharmacy_phoneNumber" required autocomplete="false" type="tel" class="form-control" placeholder="Enter phone" />
                </div>
              </div>
            </div>

            <div class="form-row">
              <div class="col-md-6">
                <div class="form-group">
                  <label>Street Address</label>
                  <input name="update_address_line1" id="update_address_line1" required autocomplete="false" type="text" class="form-control" placeholder="Enter street address" />
                </div>
              </div>

              <div class="col-md-3">
              
                <label for="state">State</label>
                <select name="update_state" id="update_state" class="form-control" required>
                  <option value="">Select state</option>
                  <option value="Alabama">Alabama</option>
                  <option value="Alaska">Alaska</option>
                  <option value="Arizona">Arizona</option>
                  <option value="Arkansas">Arkansas</option>
                  <option value="California">California</option>
                  <option value="Colorado">Colorado</option>
                  <option value="Connecticut">Connecticut</option>
                  <option value="Delaware">Delaware</option>
                  <option value="Florida">Florida</option>
                  <option value="Georgia">Georgia</option>
                  <option value="Hawaii">Hawaii</option>
                  <option value="Idaho">Idaho</option>
                  <option value="Illinois">Illinois</option>
                  <option value="Indiana">Indiana</option>
                  <option value="Iowa">Iowa</option>
                  <option value="Kansas">Kansas</option>
                  <option value="Kentucky">Kentucky</option>
                  <option value="Louisiana">Louisiana</option>
                  <option value="Maine">Maine</option>
                  <option value="Maryland">Maryland</option>
                  <option value="Massachusetts">Massachusetts</option>
                  <option value="Michigan">Michigan</option>
                  <option value="Minnesota">Minnesota</option>
                  <option value="Mississippi">Mississippi</option>
                  <option value="Missouri">Missouri</option>
                  <option value="Montana">Montana</option>
                  <option value="Nebraska">Nebraska</option>
                  <option value="Nevada">Nevada</option>
                  <option value="New Hampshire">New Hampshire</option>
                  <option value="New Jersey">New Jersey</option>
                  <option value="New Mexico">New Mexico</option>
                  <option value="New York">New York</option>
                  <option value="North Carolina">North Carolina</option>
                  <option value="North Dakota">North Dakota</option>
                  <option value="Ohio">Ohio</option>
                  <option value="Oklahoma">Oklahoma</option>
                  <option value="Oregon">Oregon</option>
                  <option value="Pennsylvania">Pennsylvania</option>
                  <option value="Rhode Island">Rhode Island</option>
                  <option value="South Carolina">South Carolina</option>
                  <option value="South Dakota">South Dakota</option>
                  <option value="Tennessee">Tennessee</option>
                  <option value="Texas">Texas</option>
                  <option value="Utah">Utah</option>
                  <option value="Vermont">Vermont</option>
                  <option value="Virginia">Virginia</option>
                  <option value="Washington">Washington</option>
                  <option value="West Virginia">West Virginia</option>
                  <option value="Wisconsin">Wisconsin</option>
                  <option value="Wyoming">Wyoming</option>
                </select>
              </div>

              <div class="col-md-3">
                <div class="form-group">
                
                  <label>State Code</label>
                  <select name="update_state_code" id="update_state_code" class="form-control" required>
                    <option value="">Select state code</option>
                    <option value="AL">AL</option>
                    <option value="AK">AK</option>
                    <option value="AZ">AZ</option>
                    <option value="AR">AR</option>
                    <option value="CA">CA</option>
                    <option value="CO">CO</option>
                    <option value="CT">CT</option>
                    <option value="DE">DE</option>
                    <option value="FL">FL</option>
                    <option value="GA">GA</option>
                    <option value="HI">HI</option>
                    <option value="ID">ID</option>
                    <option value="IL">IL</option>
                    <option value="IN">IN</option>
                    <option value="IA">IA</option>
                    <option value="KS">KS</option>
                    <option value="KY">KY</option>
                    <option value="LA">LA</option>
                    <option value="ME">ME</option>
                    <option value="MD">MD</option>
                    <option value="MA">MA</option>
                    <option value="MI">MI</option>
                    <option value="MN">MN</option>
                    <option value="MS">MS</option>
                    <option value="MO">MO</option>
                    <option value="MT">MT</option>
                    <option value="NE">NE</option>
                    <option value="NV">NV</option>
                    <option value="NH">NH</option>
                    <option value="NJ">NJ</option>
                    <option value="NM">NM</option>
                    <option value="NY">NY</option>
                    <option value="NC">NC</option>
                    <option value="ND">ND</option>
                    <option value="OH">OH</option>
                    <option value="OK">OK</option>
                    <option value="OR">OR</option>
                    <option value="PA">PA</option>
                    <option value="RI">RI</option>
                    <option value="SC">SC</option>
                    <option value="SD">SD</option>
                    <option value="TN">TN</option>
                    <option value="TX">TX</option>
                    <option value="UT">UT</option>
                    <option value="VT">VT</option>
                    <option value="VA">VA</option>
                    <option value="WA">WA</option>
                    <option value="WV">WV</option>
                    <option value="WI">WI</option>
                    <option value="WY">WY</option>
                  </select>
                
                </div>
              </div>
            </div>

            <div class="form-row">
              <div class="col-md-6">
                <label>City</label>
                <input type="text" name="update_city" id="update_city" class="form-control" placeholder="Enter city" required />
              </div>
              <div class="col-md-3">
                <label>Zip</label>
                <input type="text" name="update_zip_code" id="update_zip_code" class="form-control" placeholder="Enter Zip" required />
              </div>
              <div class="col-md-3">
                <label>Country</label>
                <input type="text" name="update_country" id="update_country" class="form-control" placeholder="Enter country" value="US" />
              </div>
              
            </div>

            <!-- add a form row same as above with 4 values, weight, dim1, dim2, dim3-->
            <br>
            <div class="form-row">
              <div class="col-md-3">
                <label>Weight</label>
                <input type="text" name="update_weight" id="update_weight" class="form-control" placeholder="Enter weight" required />
              </div>
              <div class="col-md-3">
                <label>Dim1</label>
                <input type="text" name="update_dim1" id="update_dim1" class="form-control" placeholder="Enter dim1" required />
              </div>
              <div class="col-md-3">
                <label>Dim2</label>
                <input type="text" name="update_dim2" id="update_dim2" class="form-control" placeholder="Enter dim2" required />
              </div>
              <div class="col-md-3">
                <label>Dim3</label>
                <input type="text" name="update_dim3" id="update_dim3" class="form-control" placeholder="Enter dim3" required />
              </div>
            </div>

            <div class="modal-footer">
              <button form="update-pharmacy-form" type="submit" class="btn btn-primary">Update</button>
              <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
          </form>
        </div>

        
      </div>
    </div>
  </div>

  <table id="ordersTable" class="mytable">
    <!-- Table content goes here -->
  </table>

  <script>
    window.onload = function () {
      fetchAllPharmacyData()
    }
    
    function fetchAllPharmacyData() {
      fetch('/management/fetch_all_pharmacy_data/', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({})
      })
        .then((response) => response.text())
        .then((data) => {
          var parsedData = JSON.parse(data)
    
          // Create a table
          var table = document.getElementById('ordersTable')
    
          // Create table header row
          var thead = document.createElement('thead')
          var headerRow = document.createElement('tr')
    
          // Get keys from the first object in the data array
          var keys = Object.keys(parsedData[0])
    
          // Create a table header for each key
          keys.forEach((key) => {
            var th = document.createElement('th')
            th.textContent = key
            headerRow.appendChild(th)
          })
          
          var th = document.createElement('th')
          th.textContent = "Update"
          headerRow.appendChild(th)

          var th = document.createElement('th')
          th.textContent = "Delete"
          headerRow.appendChild(th)

          thead.appendChild(headerRow)
          table.appendChild(thead)
    
          // Create table body
          var tbody = document.createElement('tbody')
    
          // Create a table row for each object in the data array
          parsedData.forEach((item) => {
            var row = document.createElement('tr')
    
            // Create a table cell for each value in the object
            keys.forEach((key) => {
              var cell = document.createElement('td')
              
              if(key == "Status") {
                var link = document.createElement('a');
                link.href = `/management/change_pharmacy_status?ncpdpid=${item.NCPDPID}` ;
                
                if(item[key] == true) {
                  link.textContent = "Pharmacy Enabled";
                  link.style.color = "green";
                  link.title = "Click to disable the pharmacy";
                } else {
                  link.textContent = "Pharmacy Disabled";
                  link.style.color = "red";
                  link.title = "Click to eable the pharmacy";
                }

                cell.appendChild(link);
              }
              else {
                cell.textContent = item[key]
              }


              row.appendChild(cell)
            })
            
            // Add edit button
            var editCell = document.createElement('td');
            var editButton = document.createElement('a');
            var editButton = document.createElement('a');
            editButton.onclick = function() {
              fetchPharmacyData(item.NCPDPID);
            };
            editButton.setAttribute("data-toggle", "modal");
            editButton.setAttribute("data-target", "#updateModal");
            //set color blue
            editButton.style.color = "#007bff";
            //on hover should show pointer
            editButton.style.cursor = "pointer";
            editButton.textContent = 'Edit';
            editCell.appendChild(editButton);
            row.appendChild(editCell);

            // Add delete button
            var deleteCell = document.createElement('td')
            var deleteButton = document.createElement('a')
            deleteButton.href = `/management/delete_pharmacy?ncpdpid=${item.NCPDPID}` 
            deleteButton.textContent = 'Delete'
            deleteButton.onclick = function() {
              return confirm('Are you sure you want to delete this Pharmacy?');
            };
            
            deleteButton.title = 'Click to delete the pharmacy'
            deleteButton.style.color = 'red'
            deleteCell.appendChild(deleteButton)
            row.appendChild(deleteCell)

            tbody.appendChild(row)
          })
    
          table.appendChild(tbody)
        })
    }
  </script>



  <script>
  function fetchPharmacyData(ncpdpid) {
    
    // Fetch user roles from your server
    fetch('/management/fetch_pharmacy_data/', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({"ncpdpid": ncpdpid})
    })
    .then((response) => response.text())  // Get the response as text
    .then((data) => {
      var parsedData = JSON.parse(data);  // Parse the data as JSON
      console.log(parsedData);  // Log the parsed data to the console
      document.getElementById('update_pharmacy_name').value = parsedData['name'];
      document.getElementById('update_pharmacy_email').value = parsedData['email'];
      document.getElementById('update_ncpdpid').value = parsedData['ncpdpid'];
      document.getElementById('update_pharmacy_phoneNumber').value = parsedData['phoneNumber'];
      document.getElementById('update_address_line1').value = parsedData['address']['line1'];
      document.getElementById('update_city').value = parsedData['address']['city'];
      document.getElementById('update_zip_code').value = parsedData['address']['zip_code'];
      document.getElementById('update_country').value = parsedData['address']['country'];
      document.getElementById('update_weight').value = parsedData['weight'];
      document.getElementById('update_dim1').value = parsedData['dim1'];
      document.getElementById('update_dim2').value = parsedData['dim2'];
      document.getElementById('update_dim3').value = parsedData['dim3'];
      document.getElementById('update_state').value = parsedData['address']['state'];
      document.getElementById('update_state_code').value = parsedData['address']['state_code'];
      
    })
    .catch((error) => {
      console.error('Error:', error);
    });
  }
  


  </script>



{% endblock %}
